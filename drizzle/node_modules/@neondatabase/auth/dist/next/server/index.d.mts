import { O as BetterAuthSession, k as BetterAuthUser } from "../../adapter-core-y53SWo8w.mjs";
import "../../better-auth-react-adapter-B7zoQmoL.mjs";
import "../../supabase-adapter-Dm56RKRF.mjs";
import { o as VanillaBetterAuthClient } from "../../neon-auth-oDgy6lQm.mjs";
import { NextRequest, NextResponse } from "next/server";

//#region src/server/endpoints.d.ts

declare const API_ENDPOINTS: {
  readonly getSession: {
    readonly path: "get-session";
    readonly method: "GET";
  };
  readonly getAccessToken: {
    readonly path: "get-access-token";
    readonly method: "GET";
  };
  readonly listSessions: {
    readonly path: "list-sessions";
    readonly method: "GET";
  };
  readonly revokeSession: {
    readonly path: "revoke-session";
    readonly method: "POST";
  };
  readonly revokeSessions: {
    readonly path: "revoke-sessions";
    readonly method: "POST";
  };
  readonly revokeOtherSessions: {
    readonly path: "revoke-all-sessions";
    readonly method: "POST";
  };
  readonly refreshToken: {
    readonly path: "refresh-token";
    readonly method: "POST";
  };
  readonly signIn: {
    readonly email: {
      readonly path: "sign-in/email";
      readonly method: "POST";
    };
    readonly social: {
      readonly path: "sign-in/social";
      readonly method: "POST";
    };
    readonly emailOtp: {
      readonly path: "sign-in/email-otp";
      readonly method: "POST";
    };
  };
  readonly signUp: {
    readonly email: {
      readonly path: "sign-up/email";
      readonly method: "POST";
    };
  };
  readonly signOut: {
    readonly path: "sign-out";
    readonly method: "POST";
  };
  readonly listAccounts: {
    readonly path: "list-accounts";
    readonly method: "GET";
  };
  readonly accountInfo: {
    readonly path: "account-info";
    readonly method: "GET";
  };
  readonly updateUser: {
    readonly path: "update-user";
    readonly method: "POST";
  };
  readonly deleteUser: {
    readonly path: "delete-user";
    readonly method: "POST";
  };
  readonly changePassword: {
    readonly path: "change-password";
    readonly method: "POST";
  };
  readonly sendVerificationEmail: {
    readonly path: "send-verification-email";
    readonly method: "POST";
  };
  readonly verifyEmail: {
    readonly path: "verify-email";
    readonly method: "POST";
  };
  readonly resetPassword: {
    readonly path: "reset-password";
    readonly method: "POST";
  };
  readonly requestPasswordReset: {
    readonly path: "request-password-reset";
    readonly method: "POST";
  };
  readonly token: {
    readonly path: "token";
    readonly method: "GET";
  };
  readonly jwks: {
    readonly path: "jwt";
    readonly method: "GET";
  };
  readonly getAnonymousToken: {
    readonly path: "token/anonymous";
    readonly method: "GET";
  };
  readonly admin: {
    readonly createUser: {
      readonly path: "admin/create-user";
      readonly method: "POST";
    };
    readonly listUsers: {
      readonly path: "admin/list-users";
      readonly method: "GET";
    };
    readonly setRole: {
      readonly path: "admin/set-role";
      readonly method: "POST";
    };
    readonly setUserPassword: {
      readonly path: "admin/set-user-password";
      readonly method: "POST";
    };
    readonly updateUser: {
      readonly path: "admin/update-user";
      readonly method: "POST";
    };
    readonly banUser: {
      readonly path: "admin/ban-user";
      readonly method: "POST";
    };
    readonly unbanUser: {
      readonly path: "admin/unban-user";
      readonly method: "POST";
    };
    readonly listUserSessions: {
      readonly path: "admin/list-user-sessions";
      readonly method: "GET";
    };
    readonly revokeUserSession: {
      readonly path: "admin/revoke-user-session";
      readonly method: "POST";
    };
    readonly revokeUserSessions: {
      readonly path: "admin/revoke-user-sessions";
      readonly method: "POST";
    };
    readonly impersonateUser: {
      readonly path: "admin/impersonate-user";
      readonly method: "POST";
    };
    readonly stopImpersonating: {
      readonly path: "admin/stop-impersonating";
      readonly method: "POST";
    };
    readonly removeUser: {
      readonly path: "admin/remove-user";
      readonly method: "POST";
    };
    readonly hasPermission: {
      readonly path: "admin/has-permission";
      readonly method: "POST";
    };
  };
  readonly organization: {
    readonly create: {
      readonly path: "organization/create";
      readonly method: "POST";
    };
    readonly update: {
      readonly path: "organization/update";
      readonly method: "POST";
    };
    readonly delete: {
      readonly path: "organization/delete";
      readonly method: "POST";
    };
    readonly list: {
      readonly path: "organization/list";
      readonly method: "GET";
    };
    readonly getFullOrganization: {
      readonly path: "organization/get-full-organization";
      readonly method: "GET";
    };
    readonly setActive: {
      readonly path: "organization/set-active";
      readonly method: "POST";
    };
    readonly checkSlug: {
      readonly path: "organization/check-slug";
      readonly method: "GET";
    };
    readonly listMembers: {
      readonly path: "organization/list-members";
      readonly method: "GET";
    };
    readonly removeMember: {
      readonly path: "organization/remove-member";
      readonly method: "POST";
    };
    readonly updateMemberRole: {
      readonly path: "organization/update-member-role";
      readonly method: "POST";
    };
    readonly leave: {
      readonly path: "organization/leave";
      readonly method: "POST";
    };
    readonly getActiveMember: {
      readonly path: "organization/get-active-member";
      readonly method: "GET";
    };
    readonly getActiveMemberRole: {
      readonly path: "organization/get-active-member-role";
      readonly method: "GET";
    };
    readonly inviteMember: {
      readonly path: "organization/invite-member";
      readonly method: "POST";
    };
    readonly acceptInvitation: {
      readonly path: "organization/accept-invitation";
      readonly method: "POST";
    };
    readonly rejectInvitation: {
      readonly path: "organization/reject-invitation";
      readonly method: "POST";
    };
    readonly cancelInvitation: {
      readonly path: "organization/cancel-invitation";
      readonly method: "POST";
    };
    readonly getInvitation: {
      readonly path: "organization/get-invitation";
      readonly method: "GET";
    };
    readonly listInvitations: {
      readonly path: "organization/list-invitations";
      readonly method: "GET";
    };
    readonly listUserInvitations: {
      readonly path: "organization/list-user-invitations";
      readonly method: "GET";
    };
    readonly hasPermission: {
      readonly path: "organization/has-permission";
      readonly method: "POST";
    };
  };
  readonly emailOtp: {
    readonly sendVerificationOtp: {
      readonly path: "email-otp/send-verification-otp";
      readonly method: "POST";
    };
    readonly verifyEmail: {
      readonly path: "email-otp/verify-email";
      readonly method: "POST";
    };
    readonly checkVerificationOtp: {
      readonly path: "email-otp/check-verification-otp";
      readonly method: "POST";
    };
    readonly resetPassword: {
      readonly path: "email-otp/passcode";
      readonly method: "POST";
    };
  };
};
//#endregion
//#region src/server/types.d.ts
/**
 * Extract top-level keys from API_ENDPOINTS.
 * For nested endpoints like signIn.email, this extracts 'signIn' (not 'email').
 */
type TopLevelEndpointKeys<T> = { [K in keyof T]: K }[keyof T];
type ServerAuthMethods = TopLevelEndpointKeys<typeof API_ENDPOINTS>;
type NeonAuthServer = Pick<VanillaBetterAuthClient, ServerAuthMethods>;
//#endregion
//#region src/next/auth/session.d.ts
type SessionData = {
  session: BetterAuthSession;
  user: BetterAuthUser;
} | {
  session: null;
  user: null;
};
/**
 * A utility function to be used in react server components fetch the session details from the Neon Auth API, if session token is available in cookie.
 *
 * @returns - `{ session: Session, user: User }` | `{ session: null, user: null}`.
 *
 * @example
 * ```ts
 * import { neonAuth } from "@neondatabase/auth/next/server"
 *
 * const { session, user } = await neonAuth()
 * ```
 */
declare const neonAuth: () => Promise<SessionData>;
//#endregion
//#region src/next/middleware/index.d.ts
type NeonAuthMiddlewareOptions = {
  loginUrl?: string;
};
/**
 * A Next.js middleware to protect routes from unauthenticated requests and refresh the session if required.
 *
 * @param loginUrl - The URL to redirect to when the user is not authenticated.
 * @returns A middleware function that can be used in the Next.js app.
 *
 * @example
 * ```ts
 * import { neonAuthMiddleware } from "@neondatabase/auth/next"
 *
 * export default neonAuthMiddleware({
 *   loginUrl: '/auth/sign-in',
 * });
 * ```
 */
declare function neonAuthMiddleware({
  loginUrl
}: NeonAuthMiddlewareOptions): (request: NextRequest) => Promise<NextResponse<unknown>>;
//#endregion
//#region src/next/handler/index.d.ts
type Params = {
  path: string[];
};
/**
 *
 * An API route handler to handle the auth requests from the client and proxy them to the Neon Auth.
 *
 * @returns A Next.js API handler functions those can be used in a Next.js route.
 *
 * @example
 * Mount the `authApiHandler` to an API route. Create a route file inside `/api/auth/[...all]/route.ts` directory.
 *  And add the following code:
 *
 * ```ts
 * // app/api/auth/[...all]/route.ts
 * import { authApiHandler } from '@neondatabase/auth/next';
 *
 * export const { GET, POST } = authApiHandler();
 * ```
 */
declare function authApiHandler(): {
  GET: (request: Request, {
    params
  }: {
    params: Promise<Params>;
  }) => Promise<Response>;
  POST: (request: Request, {
    params
  }: {
    params: Promise<Params>;
  }) => Promise<Response>;
  PUT: (request: Request, {
    params
  }: {
    params: Promise<Params>;
  }) => Promise<Response>;
  DELETE: (request: Request, {
    params
  }: {
    params: Promise<Params>;
  }) => Promise<Response>;
  PATCH: (request: Request, {
    params
  }: {
    params: Promise<Params>;
  }) => Promise<Response>;
};
//#endregion
//#region src/next/server/index.d.ts
/**
 * Creates a server-side auth API client for Next.js.
 *
 * This client exposes the Neon Auth APIs including authentication, user management, organizations, and admin operations.
 *
 * **Where to use:**
 * - React Server Components
 * - Server Actions
 * - Route Handlers
 *
 * **Requirements:**
 * - `NEON_AUTH_BASE_URL` environment variable must be set
 * - Cookies are automatically read/written via `next/headers`
 *
 * @returns Auth server API client for Next.js
 * @throws Error if `NEON_AUTH_BASE_URL` environment variable is not set
 *
 * @example
 * ```typescript
 * // lib/auth/server.ts - Create a singleton instance
 * import { createAuthServer } from '@neondatabase/auth/next/server';
 * export const authServer = createAuthServer();
 * ```
 *
 * @example
 * ```typescript
 * // Server Component - Reading session
 * import { authServer } from '@/lib/auth/server';
 *
 * export default async function Page() {
 *   const { data: session } = await authServer.getSession();
 *   if (!session?.user) return <div>Not logged in</div>;
 *   return <div>Hello {session.user.name}</div>;
 * }
 * ```
 *
 * @example
 * ```typescript
 * // Server Action - Sign in
 * 'use server';
 * import { authServer } from '@/lib/auth/server';
 * import { redirect } from 'next/navigation';
 *
 * export async function signIn(formData: FormData) {
 *   const { error } = await authServer.signIn.email({
 *     email: formData.get('email') as string,
 *     password: formData.get('password') as string,
 *   });
 *   if (error) return { error: error.message };
 *   redirect('/dashboard');
 * }
 * ```
 */
declare function createAuthServer(): NeonAuthServer;
//#endregion
export { authApiHandler, createAuthServer, neonAuth, neonAuthMiddleware };