{"version":3,"file":"InstantNextDatabase.js","sourceRoot":"","sources":["../../../src/next-ssr/InstantNextDatabase.tsx"],"names":[],"mappings":";;;;;;AAQA,+FAAoE;AACpE,iCAAmC;AACnC,8EAAsE;AAEtE,MAAa,mBAGX,SAAQ,oCAAyC;IAC1C,gBAAgB,GAAG,CACxB,CAAI,EACJ,IAEC,EAID,EAAE;QACF,MAAM,GAAG,GAAG,IAAA,kBAAU,EAAC,mDAAqB,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,MAAM,IAAI,KAAK,CACb,8DAA8D,CAC/D,CAAC;QACJ,CAAC;QACD,OAAO,GAAG,CAAC,gBAAgB,CAAC,CAAC,EAAE,IAAI,CAAQ,CAAC;IAC9C,CAAC,CAAC;IAEF,OAAO,GAAG,GAAc,EAAE;QACxB,MAAM,GAAG,GAAG,IAAA,kBAAU,EAAC,mDAAqB,CAAC,CAAC;QAC9C,MAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,OAAO,cAAc,CAAC;QACxB,CAAC;QAED,MAAM,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC;QACxB,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;YAC1B,OAAO,cAAc,CAAC;QACxB,CAAC;QACD,IAAI,cAAc,CAAC,SAAS,EAAE,CAAC;YAC7B,OAAO;gBACL,KAAK,EAAE,SAAS;gBAChB,SAAS,EAAE,KAAK;gBAChB,IAAI,EAAE,OAAO,IAAI,SAAS,EAAE,qCAAqC;aAClE,CAAC;QACJ,CAAC;QAED,OAAO,cAAc,CAAC;IACxB,CAAC,CAAC;CACH;AA3CD,kDA2CC","sourcesContent":["import {\n  AuthState,\n  InstantSchemaDef,\n  InstaQLResponse,\n  PageInfoResponse,\n  RuleParams,\n  ValidQuery,\n} from '@instantdb/core';\nimport InstantReactWebDatabase from '../InstantReactWebDatabase.ts';\nimport { useContext } from 'react';\nimport { SuspsenseQueryContext } from './InstantSuspenseProvider.tsx';\n\nexport class InstantNextDatabase<\n  Schema extends InstantSchemaDef<any, any, any>,\n  UseDates extends boolean,\n> extends InstantReactWebDatabase<Schema, UseDates> {\n  public useSuspenseQuery = <Q extends ValidQuery<Q, Schema>>(\n    q: Q,\n    opts?: {\n      ruleParams: RuleParams;\n    },\n  ): {\n    data: InstaQLResponse<Schema, Q, NonNullable<UseDates>>;\n    pageInfo?: PageInfoResponse<Q>;\n  } => {\n    const ctx = useContext(SuspsenseQueryContext);\n    if (!ctx) {\n      throw new Error(\n        'useSuspenseQuery must be used within a SuspenseQueryProvider',\n      );\n    }\n    return ctx.useSuspenseQuery(q, opts) as any;\n  };\n\n  useAuth = (): AuthState => {\n    const ctx = useContext(SuspsenseQueryContext);\n    const realAuthResult = this._useAuth();\n    if (!ctx) {\n      return realAuthResult;\n    }\n\n    const { ssrUser } = ctx;\n    if (ssrUser === undefined) {\n      return realAuthResult;\n    }\n    if (realAuthResult.isLoading) {\n      return {\n        error: undefined,\n        isLoading: false,\n        user: ssrUser ?? undefined, // null -> undefined for the response\n      };\n    }\n\n    return realAuthResult;\n  };\n}\n"]}