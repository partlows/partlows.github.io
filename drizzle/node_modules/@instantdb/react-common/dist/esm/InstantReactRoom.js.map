{"version":3,"file":"InstantReactRoom.js","sourceRoot":"","sources":["../../src/InstantReactRoom.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  // types\n  type PresenceOpts,\n  type PresenceResponse,\n  type RoomSchemaShape,\n  InstantCoreDatabase,\n  InstantSchemaDef,\n} from '@instantdb/core';\n\nimport {\n  KeyboardEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { useTimeout } from './useTimeout.ts';\n\nexport type PresenceHandle<\n  PresenceShape,\n  Keys extends keyof PresenceShape,\n> = PresenceResponse<PresenceShape, Keys> & {\n  publishPresence: (data: Partial<PresenceShape>) => void;\n};\n\nexport type TypingIndicatorOpts = {\n  timeout?: number | null;\n  stopOnEnter?: boolean;\n  // Perf opt - `active` will always be an empty array\n  writeOnly?: boolean;\n};\n\nexport type TypingIndicatorHandle<PresenceShape> = {\n  active: PresenceShape[];\n  setActive(active: boolean): void;\n  inputProps: {\n    onKeyDown: (e: KeyboardEvent) => void;\n    onBlur: () => void;\n  };\n};\n\nexport const defaultActivityStopTimeout = 1_000;\n\n// ------\n// Topics\n\n/**\n * Listen for broadcasted events given a room and topic.\n *\n * @see https://instantdb.com/docs/presence-and-topics\n * @example\n *  function App({ roomId }) {\n *    const room = db.room('chats', roomId);\n *    db.rooms.useTopicEffect(room, 'emoji', (message, peer) => {\n *      console.log(peer.name, 'sent', message);\n *    });\n *    // ...\n *  }\n */\nexport function useTopicEffect<\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n  TopicType extends keyof RoomSchema[RoomType]['topics'],\n>(\n  room: InstantReactRoom<any, RoomSchema, RoomType>,\n  topic: TopicType,\n  onEvent: (\n    event: RoomSchema[RoomType]['topics'][TopicType],\n    peer: RoomSchema[RoomType]['presence'],\n  ) => any,\n): void {\n  const onEventRef = useRef(onEvent);\n  onEventRef.current = onEvent;\n\n  useEffect(() => {\n    const unsub = room.core._reactor.subscribeTopic(\n      room.id,\n      topic,\n      (event, peer) => {\n        onEventRef.current(event, peer);\n      },\n    );\n\n    return unsub;\n  }, [room.id, topic]);\n}\n\n/**\n * Broadcast an event to a room.\n *\n * @see https://instantdb.com/docs/presence-and-topics\n * @example\n * function App({ roomId }) {\n *   const room = db.room('chat', roomId);\n *   const publishTopic = db.rooms.usePublishTopic(room, \"emoji\");\n *\n *   return (\n *     <button onClick={() => publishTopic({ emoji: \"ðŸ”¥\" })}>Send emoji</button>\n *   );\n * }\n *\n */\nexport function usePublishTopic<\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n  TopicType extends keyof RoomSchema[RoomType]['topics'],\n>(\n  room: InstantReactRoom<any, RoomSchema, RoomType>,\n  topic: TopicType,\n): (data: RoomSchema[RoomType]['topics'][TopicType]) => void {\n  useEffect(() => room.core._reactor.joinRoom(room.id), [room.id]);\n\n  const publishTopic = useCallback(\n    (data) => {\n      room.core._reactor.publishTopic({\n        roomType: room.type,\n        roomId: room.id,\n        topic,\n        data,\n      });\n    },\n    [room.id, topic],\n  );\n\n  return publishTopic;\n}\n\n// ---------\n// Presence\n\n/**\n * Listen for peer's presence data in a room, and publish the current user's presence.\n *\n * @see https://instantdb.com/docs/presence-and-topics\n * @example\n *  function App({ roomId }) {\n *    const {\n *      peers,\n *      publishPresence\n *    } = db.room(roomType, roomId).usePresence({ keys: [\"name\", \"avatar\"] });\n *\n *    // ...\n *  }\n */\nexport function usePresence<\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n  Keys extends keyof RoomSchema[RoomType]['presence'],\n>(\n  room: InstantReactRoom<any, RoomSchema, RoomType>,\n  opts: PresenceOpts<RoomSchema[RoomType]['presence'], Keys> = {},\n): PresenceHandle<RoomSchema[RoomType]['presence'], Keys> {\n  const [state, setState] = useState<\n    PresenceResponse<RoomSchema[RoomType]['presence'], Keys>\n  >(() => {\n    return (\n      room.core._reactor.getPresence(room.type, room.id, opts) ?? {\n        peers: {},\n        isLoading: true,\n      }\n    );\n  });\n\n  useEffect(() => {\n    const unsub = room.core._reactor.subscribePresence(\n      room.type,\n      room.id,\n      opts,\n      (data) => {\n        setState(data);\n      },\n    );\n\n    return unsub;\n  }, [room.id, opts.user, opts.peers?.join(), opts.keys?.join()]);\n\n  const publishPresence = useCallback(\n    (data) => {\n      room.core._reactor.publishPresence(room.type, room.id, data);\n    },\n    [room.type, room.id],\n  );\n  const ret = useMemo(() => {\n    return {\n      ...state,\n      publishPresence,\n    };\n  }, [state, publishPresence]);\n  return ret;\n}\n\n/**\n * Publishes presence data to a room\n *\n * @see https://instantdb.com/docs/presence-and-topics\n * @example\n *  function App({ roomId, nickname }) {\n *    const room = db.room('chat', roomId);\n *    db.rooms.useSyncPresence(room, { nickname });\n *  }\n */\nexport function useSyncPresence<\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n>(\n  room: InstantReactRoom<any, RoomSchema, RoomType>,\n  data: Partial<RoomSchema[RoomType]['presence']>,\n  deps?: any[],\n): void {\n  useEffect(() => room.core._reactor.joinRoom(room.id, data), [room.id]);\n  useEffect(() => {\n    return room.core._reactor.publishPresence(room.type, room.id, data);\n  }, [room.type, room.id, deps ?? JSON.stringify(data)]);\n}\n\n// -----------------\n// Typing Indicator\n\n/**\n * Manage typing indicator state\n *\n * @see https://instantdb.com/docs/presence-and-topics\n * @example\n *  function App({ roomId }) {\n *    const room = db.room('chat', roomId);\n *    const {\n *      active,\n *      setActive,\n *      inputProps,\n *    } = db.rooms.useTypingIndicator(room, \"chat-input\");\n *\n *    return <input {...inputProps} />;\n *  }\n */\nexport function useTypingIndicator<\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n>(\n  room: InstantReactRoom<any, RoomSchema, RoomType>,\n  inputName: string,\n  opts: TypingIndicatorOpts = {},\n): TypingIndicatorHandle<RoomSchema[RoomType]['presence']> {\n  const timeout = useTimeout();\n\n  const observedPresence = rooms.usePresence(room, {\n    keys: [inputName] as (keyof RoomSchema[RoomType]['presence'])[],\n  });\n\n  const active = useMemo(() => {\n    const presenceSnapshot = room._core._reactor.getPresence(\n      room.type,\n      room.id,\n    );\n\n    return opts?.writeOnly\n      ? []\n      : Object.values(presenceSnapshot?.peers ?? {}).filter(\n          (p) => p[inputName] === true,\n        );\n  }, [opts?.writeOnly, observedPresence]);\n\n  const setActive = useCallback(\n    (isActive: boolean) => {\n      room.core._reactor.publishPresence(room.type, room.id, {\n        [inputName]: isActive,\n      } as unknown as Partial<RoomSchema[RoomType]>);\n\n      if (!isActive) return;\n\n      if (opts?.timeout === null || opts?.timeout === 0) return;\n\n      timeout.set(opts?.timeout ?? defaultActivityStopTimeout, () => {\n        room.core._reactor.publishPresence(room.type, room.id, {\n          [inputName]: null,\n        } as Partial<RoomSchema[RoomType]>);\n      });\n    },\n    [room.type, room.id, inputName, opts?.timeout, timeout],\n  );\n  const onKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      const isEnter = opts?.stopOnEnter && e.key === 'Enter';\n      const isActive = !isEnter;\n\n      setActive(isActive);\n    },\n    [opts.stopOnEnter, setActive],\n  );\n  const onBlur = useCallback(() => {\n    setActive(false);\n  }, [setActive]);\n\n  const inputProps = useMemo(() => {\n    return { onKeyDown, onBlur };\n  }, [onKeyDown, onBlur]);\n\n  return {\n    active,\n    setActive,\n    inputProps,\n  };\n}\n\n// --------------\n// Hooks\n\nexport const rooms = {\n  useTopicEffect,\n  usePublishTopic,\n  usePresence,\n  useSyncPresence,\n  useTypingIndicator,\n};\n\n// ------------\n// Class\n\nexport class InstantReactRoom<\n  Schema extends InstantSchemaDef<any, any, any>,\n  RoomSchema extends RoomSchemaShape,\n  RoomType extends keyof RoomSchema,\n> {\n  core: InstantCoreDatabase<Schema, boolean>;\n  /** @deprecated use `core` instead */\n  _core: InstantCoreDatabase<Schema, boolean>;\n  type: RoomType;\n  id: string;\n\n  constructor(\n    core: InstantCoreDatabase<Schema, boolean>,\n    type: RoomType,\n    id: string,\n  ) {\n    this.core = core;\n    this._core = this.core;\n    this.type = type;\n    this.id = id;\n  }\n\n  /**\n   * @deprecated\n   * `db.room(...).useTopicEffect` is deprecated. You can replace it with `db.rooms.useTopicEffect`.\n   *\n   * @example\n   *\n   * // Before\n   * const room = db.room('chat', 'room-id');\n   * room.useTopicEffect('emoji', (message, peer) => {  });\n   *\n   * // After\n   * const room = db.room('chat', 'room-id');\n   * db.rooms.useTopicEffect(room, 'emoji', (message, peer) => {  });\n   */\n  useTopicEffect = <TopicType extends keyof RoomSchema[RoomType]['topics']>(\n    topic: TopicType,\n    onEvent: (\n      event: RoomSchema[RoomType]['topics'][TopicType],\n      peer: RoomSchema[RoomType]['presence'],\n    ) => any,\n  ): void => {\n    rooms.useTopicEffect(this, topic, onEvent);\n  };\n\n  /**\n   * @deprecated\n   * `db.room(...).usePublishTopic` is deprecated. You can replace it with `db.rooms.usePublishTopic`.\n   *\n   * @example\n   *\n   * // Before\n   * const room = db.room('chat', 'room-id');\n   * const publish = room.usePublishTopic('emoji');\n   *\n   * // After\n   * const room = db.room('chat', 'room-id');\n   * const publish = db.rooms.usePublishTopic(room, 'emoji');\n   */\n  usePublishTopic = <Topic extends keyof RoomSchema[RoomType]['topics']>(\n    topic: Topic,\n  ): ((data: RoomSchema[RoomType]['topics'][Topic]) => void) => {\n    return rooms.usePublishTopic(this, topic);\n  };\n\n  /**\n   * @deprecated\n   * `db.room(...).usePresence` is deprecated. You can replace it with `db.rooms.usePresence`.\n   *\n   * @example\n   *\n   * // Before\n   * const room = db.room('chat', 'room-id');\n   * const { peers } = room.usePresence({ keys: [\"name\", \"avatar\"] });\n   *\n   * // After\n   * const room = db.room('chat', 'room-id');\n   * const { peers } = db.rooms.usePresence(room, { keys: [\"name\", \"avatar\"] });\n   */\n  usePresence = <Keys extends keyof RoomSchema[RoomType]['presence']>(\n    opts: PresenceOpts<RoomSchema[RoomType]['presence'], Keys> = {},\n  ): PresenceHandle<RoomSchema[RoomType]['presence'], Keys> => {\n    return rooms.usePresence(this, opts);\n  };\n\n  /**\n   * @deprecated\n   * `db.room(...).useSyncPresence` is deprecated. You can replace it with `db.rooms.useSyncPresence`.\n   *\n   * @example\n   *\n   * // Before\n   * const room = db.room('chat', 'room-id');\n   * room.useSyncPresence(room, { nickname });\n   *\n   * // After\n   * const room = db.room('chat', 'room-id');\n   * db.rooms.useSyncPresence(room, { nickname });\n   */\n  useSyncPresence = (\n    data: Partial<RoomSchema[RoomType]['presence']>,\n    deps?: any[],\n  ): void => {\n    return rooms.useSyncPresence(this, data, deps);\n  };\n\n  /**\n   * @deprecated\n   * `db.room(...).useTypingIndicator` is deprecated. You can replace it with `db.rooms.useTypingIndicator`.\n   *\n   * @example\n   *\n   * // Before\n   * const room = db.room('chat', 'room-id');\n   * const typing = room.useTypingIndiactor(room, 'chat-input');\n   *\n   * // After\n   * const room = db.room('chat', 'room-id');\n   * const typing = db.rooms.useTypingIndiactor(room, 'chat-input');\n   */\n  useTypingIndicator = (\n    inputName: string,\n    opts: TypingIndicatorOpts = {},\n  ): TypingIndicatorHandle<RoomSchema[RoomType]['presence']> => {\n    return rooms.useTypingIndicator(this, inputName, opts);\n  };\n}\n"]}