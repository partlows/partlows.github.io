{"version":3,"file":"parseSchemaFromJSON.js","sourceRoot":"","sources":["../../src/parseSchemaFromJSON.ts"],"names":[],"mappings":"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","sourcesContent":["import { i } from './schema.ts';\nimport { DataAttrDef, InstantSchemaDef } from './schemaTypes.ts';\n\nexport const parseSchemaFromJSON = (\n  s: any,\n): InstantSchemaDef<any, any, any> => {\n  // Parse entities\n  const entities: Record<string, any> = {};\n\n  for (const [entityName, entityInfo] of Object.entries(s.entities)) {\n    const entityDef = entityInfo as any;\n    const attrs: Record<string, any> = {};\n\n    // Parse attributes\n    for (const [attrName, attrInfo] of Object.entries(entityDef.attrs)) {\n      const attrDef = attrInfo as any;\n      let attr: DataAttrDef<any, any, any>;\n\n      // Create the appropriate attribute type\n      switch (attrDef.valueType) {\n        case 'string':\n          attr = i.string();\n          break;\n        case 'number':\n          attr = i.number();\n          break;\n        case 'boolean':\n          attr = i.boolean();\n          break;\n        case 'date':\n          attr = i.date();\n          break;\n        case 'json':\n          attr = i.json();\n          break;\n        default:\n          attr = i.json();\n      }\n\n      // Apply modifiers\n      if (!attrDef.required) {\n        attr = attr.optional();\n      }\n\n      if (attrDef.config?.indexed) {\n        attr = attr.indexed();\n      }\n\n      if (attrDef.config?.unique) {\n        attr = attr.unique();\n      }\n\n      attrs[attrName] = attr;\n    }\n\n    entities[entityName] = i.entity(attrs);\n  }\n\n  // Parse links\n  const links: Record<string, any> = s.links || {};\n\n  // Parse rooms\n  const rooms: Record<string, any> = {};\n\n  if (s.rooms) {\n    for (const [roomName, roomInfo] of Object.entries(s.rooms)) {\n      const roomDef = roomInfo as any;\n\n      // Parse presence\n      const presenceAttrs: Record<string, any> = {};\n      for (const [attrName, attrInfo] of Object.entries(\n        roomDef.presence.attrs,\n      )) {\n        const attrDef = attrInfo as any;\n        let attr: DataAttrDef<any, any, any>;\n\n        switch (attrDef.valueType) {\n          case 'string':\n            attr = i.string();\n            break;\n          case 'number':\n            attr = i.number();\n            break;\n          case 'boolean':\n            attr = i.boolean();\n            break;\n          case 'date':\n            attr = i.date();\n            break;\n          case 'json':\n            attr = i.json();\n            break;\n          default:\n            attr = i.json();\n        }\n\n        if (!attrDef.required) {\n          attr = attr.optional();\n        }\n\n        if (attrDef.config?.indexed) {\n          attr = attr.indexed();\n        }\n\n        if (attrDef.config?.unique) {\n          attr = attr.unique();\n        }\n\n        presenceAttrs[attrName] = attr;\n      }\n\n      // Parse topics\n      const topics: Record<string, any> = {};\n      if (roomDef.topics) {\n        for (const [topicName, topicInfo] of Object.entries(roomDef.topics)) {\n          const topicDef = topicInfo as any;\n          const topicAttrs: Record<string, any> = {};\n\n          for (const [attrName, attrInfo] of Object.entries(topicDef.attrs)) {\n            const attrDef = attrInfo as any;\n            let attr: DataAttrDef<any, any, any>;\n\n            switch (attrDef.valueType) {\n              case 'string':\n                attr = i.string();\n                break;\n              case 'number':\n                attr = i.number();\n                break;\n              case 'boolean':\n                attr = i.boolean();\n                break;\n              case 'date':\n                attr = i.date();\n                break;\n              case 'json':\n                attr = i.json();\n                break;\n              default:\n                attr = i.json();\n            }\n\n            if (!attrDef.required) {\n              attr = attr.optional();\n            }\n\n            if (attrDef.config?.indexed) {\n              attr = attr.indexed();\n            }\n\n            if (attrDef.config?.unique) {\n              attr = attr.unique();\n            }\n\n            topicAttrs[attrName] = attr;\n          }\n\n          topics[topicName] = i.entity(topicAttrs);\n        }\n      }\n\n      rooms[roomName] = {\n        presence: i.entity(presenceAttrs),\n        topics,\n      };\n    }\n  }\n\n  const resultingSchema = i.schema({\n    entities,\n    links,\n    rooms,\n  });\n\n  return resultingSchema;\n};\n"]}