{"version":3,"file":"StorageAPI.js","sourceRoot":"","sources":["../../src/StorageAPI.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,kBAAkB,CAAC;AAc7C,MAAM,CAAC,KAAK,UAAU,UAAU,CAAC,EAC/B,MAAM,EACN,KAAK,EACL,IAAI,EACJ,IAAI,EACJ,YAAY,EACZ,WAAW,EACX,kBAAkB,GASnB;IACC,MAAM,OAAO,GAAG;QACd,MAAM,EAAE,KAAK;QACb,IAAI;QACJ,aAAa,EAAE,UAAU,YAAY,EAAE;QACvC,cAAc,EAAE,WAAW,IAAI,IAAI,CAAC,IAAI;KACzC,CAAC;IACF,IAAI,kBAAkB,EAAE,CAAC;QACvB,OAAO,CAAC,qBAAqB,CAAC,GAAG,kBAAkB,CAAC;IACtD,CAAC;IAED,MAAM,IAAI,GAAG,MAAM,SAAS,CAAC,GAAG,MAAM,iBAAiB,EAAE;QACvD,MAAM,EAAE,KAAK;QACb,OAAO;QACP,IAAI,EAAE,IAAI;KACX,CAAC,CAAC;IAEH,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,UAAU,CAAC,EAC/B,MAAM,EACN,KAAK,EACL,IAAI,EACJ,YAAY,GAMb;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,CAC9B,GAAG,MAAM,yBAAyB,KAAK,aAAa,kBAAkB,CAAC,IAAI,CAAC,EAAE,EAC9E;QACE,MAAM,EAAE,QAAQ;QAChB,OAAO,EAAE;YACP,cAAc,EAAE,kBAAkB;YAClC,aAAa,EAAE,UAAU,YAAY,EAAE;SACxC;KACF,CACF,CAAC;IAEF,OAAO,IAAI,CAAC;AACd,CAAC;AAED,oCAAoC;AACpC,oCAAoC;AAEpC,MAAM,CAAC,KAAK,UAAU,kBAAkB,CAAC,EACvC,MAAM,EACN,KAAK,EACL,QAAQ,EACR,YAAY,EACZ,QAAQ,GAAG,EAAE,GAOd;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,CAAC,GAAG,MAAM,4BAA4B,EAAE;QACtE,MAAM,EAAE,MAAM;QACd,OAAO,EAAE;YACP,cAAc,EAAE,kBAAkB;YAClC,aAAa,EAAE,UAAU,YAAY,EAAE;SACxC;QACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;YACnB,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,QAAQ;SACnB,CAAC;KACH,CAAC,CAAC;IAEH,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,MAAM,CAAC,YAAY,EAAE,IAAI;IAC7C,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,YAAY,EAAE;QACzC,MAAM,EAAE,KAAK;QACb,IAAI,EAAE,IAAI;QACV,OAAO,EAAE;YACP,cAAc,EAAE,IAAI,CAAC,IAAI;SAC1B;KACF,CAAC,CAAC;IAEH,OAAO,QAAQ,CAAC,EAAE,CAAC;AACrB,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,cAAc,CAAC,EACnC,MAAM,EACN,KAAK,EACL,IAAI,EACJ,YAAY,GAMb;IACC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,CAC9B,GAAG,MAAM,uCAAuC,KAAK,aAAa,kBAAkB,CAClF,IAAI,CACL,EAAE,EACH;QACE,MAAM,EAAE,KAAK;QACb,OAAO,EAAE;YACP,cAAc,EAAE,kBAAkB;YAClC,aAAa,EAAE,UAAU,YAAY,EAAE;SACxC;KACF,CACF,CAAC;IAEF,OAAO,IAAI,CAAC;AACd,CAAC","sourcesContent":["import { jsonFetch } from './utils/fetch.js';\n\nexport type UploadFileResponse = {\n  data: {\n    id: string;\n  };\n};\n\nexport type DeleteFileResponse = {\n  data: {\n    id: string | null;\n  };\n};\n\nexport async function uploadFile({\n  apiURI,\n  appId,\n  path,\n  file,\n  refreshToken,\n  contentType,\n  contentDisposition,\n}: {\n  apiURI: string;\n  appId: string;\n  path: string;\n  file: File | Blob;\n  refreshToken?: string;\n  contentType?: string;\n  contentDisposition?: string;\n}): Promise<UploadFileResponse> {\n  const headers = {\n    app_id: appId,\n    path,\n    authorization: `Bearer ${refreshToken}`,\n    'content-type': contentType || file.type,\n  };\n  if (contentDisposition) {\n    headers['content-disposition'] = contentDisposition;\n  }\n\n  const data = await jsonFetch(`${apiURI}/storage/upload`, {\n    method: 'PUT',\n    headers,\n    body: file,\n  });\n\n  return data;\n}\n\nexport async function deleteFile({\n  apiURI,\n  appId,\n  path,\n  refreshToken,\n}: {\n  apiURI: string;\n  appId: string;\n  path: string;\n  refreshToken?: string;\n}): Promise<DeleteFileResponse> {\n  const { data } = await jsonFetch(\n    `${apiURI}/storage/files?app_id=${appId}&filename=${encodeURIComponent(path)}`,\n    {\n      method: 'DELETE',\n      headers: {\n        'content-type': 'application/json',\n        authorization: `Bearer ${refreshToken}`,\n      },\n    },\n  );\n\n  return data;\n}\n\n// Deprecated Storage API (Jan 2025)\n// ---------------------------------\n\nexport async function getSignedUploadUrl({\n  apiURI,\n  appId,\n  fileName,\n  refreshToken,\n  metadata = {},\n}: {\n  apiURI: string;\n  appId: string;\n  fileName: string;\n  refreshToken?: string;\n  metadata?: Record<string, any>;\n}) {\n  const { data } = await jsonFetch(`${apiURI}/storage/signed-upload-url`, {\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json',\n      authorization: `Bearer ${refreshToken}`,\n    },\n    body: JSON.stringify({\n      app_id: appId,\n      filename: fileName,\n    }),\n  });\n\n  return data;\n}\n\nexport async function upload(presignedUrl, file) {\n  const response = await fetch(presignedUrl, {\n    method: 'PUT',\n    body: file,\n    headers: {\n      'Content-Type': file.type,\n    },\n  });\n\n  return response.ok;\n}\n\nexport async function getDownloadUrl({\n  apiURI,\n  appId,\n  path,\n  refreshToken,\n}: {\n  apiURI: string;\n  appId: string;\n  path: string;\n  refreshToken?: string;\n}) {\n  const { data } = await jsonFetch(\n    `${apiURI}/storage/signed-download-url?app_id=${appId}&filename=${encodeURIComponent(\n      path,\n    )}`,\n    {\n      method: 'GET',\n      headers: {\n        'content-type': 'application/json',\n        authorization: `Bearer ${refreshToken}`,\n      },\n    },\n  );\n\n  return data;\n}\n"]}